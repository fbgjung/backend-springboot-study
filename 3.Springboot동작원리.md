# 학습 내용
8강. HTTP가 무엇일까요? 정확히 알아야 해요  
9강. 톰캣이란 무엇인가요?

# 8️⃣ HTTP가 무엇일까요? 정확히 알아야 해요

### `TCP & HTTP`
TCP 통신과 HTTP 통신이란 해당 계층에 해당되는 규약(protocol)아래에서 이루어지는 통신을 의미한다.  
TCP 통신: 
- 양방향 통신, 소켓을 이용한 연결 방식을 사용한다.  
-  양방향 통신으로 클라이언트단과 서버단의 연결이 끊어지지않고 계속 연결을 유지해주어 실시간 소통이 가능하다.   

HTTP 통신: 
- 단방향 통신
- HTTP는 TCP에 기반하여 만들어졌기 때문에, HTTP 통신 또한 소켓 기반이다. 
- HTTP 통신은 클라이언트의 요청이 왔을때만 서버단이 응답하고 처리를 해주며 해당 응답이 끝나면 연결을 바로 끊게 된다.  
- 연결을 지속시키지 않고 끊어버리는 `stateless` 방식을 사용한다.  
 

소켓을 이용한 연결은 TCP 프로토콜 기반으로 맺어진 연결이며, 소켓 통신이라고도 부른다.  

### `소켓`
네트워크를 서로 연결하는 연결부 같은 역할을 한다.   
방식에 따라 TCP 소켓과 UDP 방식으로 나뉜다.  
OSI 7 Layer의 네 번째 계층인 TCP 상에서 동작하는 소켓을 주로 사용하는데, 이를 TCP 소켓이라고 부른다.  
운영체제가 가지고 있는 것이다.

### `소켓연결`
TCP/IP 프로토콜 기반으로 맺어진 네트워크 연결이며, 소켓통신이라고도 부른다.
일반적으로, 서버는 특정 컴퓨터 위에서 돌아가고 특정 포트넘버에 할당된 소켓을 갖는다.  
이 서버는 클라이언트가 커넥션 요청을 만들기 위한 소켓을 리스닝하며 기다린다.  
클라이언트쪽에서 커넥션이 성립된 경우, 소켓이 성공적으로 생성되며 클라이언트는 소켓을 서버와 상호작용하기 위해 사용할 수 있다.  

네트워크 위에서 돌아가는 두 프로그램 간의 양방향 통신 링크의 엔드포인트다.  
소켓은 포트 넘버를 할당받아 TCP 레이어가 데이터의 목적지인 애플리케이션을 식별하도록 한다.  
엔드포인트는 IP 주소와 포트넘버의 조합이다.

즉 IP와 포트 넘버를 활용하여 만들어진 통신의 양끝단이다.  

### `소켓 프로그래밍`
Server와 Client가 특정 Port를 통해 연결을 유지하고 있어 실시간으로 양방향 통신을 하는 방식이다.  
실시간 스트리밍 중계나 실시간 채팅과 같이 즉각적으로 정보를 주고받는 경우에 사용한다.  


### `HTTP 통신`
HTTP 통신은 TCP 위에서 이루어진다.  
즉 HTTP 또한 소켓 통신을 활용한 방식이라고 볼 수 있다. !!!!  
HTTP 통신은 TCP 통신 기반에서 데이터를 전송하는 부분만 맡아서 역할을 한다.  
HTTP 통신을 하기위해서는 OSI 계층에서 TCP 기반인 4계층에서 3-way-handshake로 연결 과정을 거치고 7계층에서 HTTP 기반으로 데이터 전송을 하고 다시 4계층에서 4-way-handshake로 연결을 끊는 과정을 거쳐야 한다.  

특정 웹페이지를 들어가기 위해 브라우저에 naver.com을 입력하면 서버단에 요청이 들어오고 naver.com에 해당하는 내용들을 브라우저(클라이언트)에게 보내고 연결이 끊기면서 끝난다.

데이터 전송에 사용되는 소켓의 통신 방식이 TCP 통신의 데이터 전송에서 사용되는 소켓 통신과는 다른 방식으로 사용이된다.  

REST API도 HTTP 통신에 해당한다.  

### `HTTP 프로그래밍`
html 파일을 전송하거나, JSON, image 파일 등을 전송하는데 사용된다.  


### `소켓 통신 예시`
A,B가 메시지를 교환하기 위해서 운영체제가 제공하는 소켓을 이용하면 된다.  
A가 포트번호를 열고 소켓을 연다. 
이때, B가 A와 통신하고 싶으면 A의 IP주소와 포트번호를 넣으면 연결이된다.  
C가 A와 메시지를 교환하고 싶은데 B가 5000번 포트로 소켓와 연결되어 있기 때문에 C가 5000번으로 연결할 수 있는 방법이 없다.  
<img width="500" alt="소켓통신" src="https://github.com/fbgjung/backend-springboot-study/assets/104186871/dc8fdf95-7cc6-4bbd-a381-d7c6dd29758f">  

최초에 5000번 포트는 연결의 용도로만 사용한다. 5000번 포트가 연결되는 순간 새로운 소켓을 만든다.  
5001번(랜덤) 포트로 소켓이 만들어지고, 5000번 포트는 연결이 끊기고 5001 포트로 연결된다.  
5001번의 새로운 소켓을 만들 때는 새로운 스레드를 하나 만든다.

main 스레드: 새로운 사용자의 요청을 받는다.  
스레드1(5001) : B와 통신한다.  
이 상황에서 C가 A의 5000번 포트와 통신할 수 있다. 
그럼 또 새로운 소켓 5002 포트가 만들어지고 스레드2가 만들어지고 C는 5000번 포트와 연결이 끊기고 다시 5002번과 연결된다.

### `스레드`  
스레드가 있으면, 시간을 쪼개서 동시에 동작하는 것 처럼 보이게 할 수 있다.  
계속 연결되어 있기 때문에 A 입장에서 B가 누군지 계속 알 수 있다.  
연결이 지속되기 때문에 부하가 크다. 연결이 늘어나면 느려질 수 있다.  

### `HTTP 통신 예시`  
<img width="500" height="250" alt="HTTP" src="https://github.com/fbgjung/backend-springboot-study/assets/104186871/dae4824d-bd21-4600-8712-2d3d964cf761">

A가 C에게 a.txt 파일을 요청할때 C 소켓이 80으로 열려있을 때 새로운 스레드를 만드는 게 아니라  
다이렉트로 a.txt파일을 찾아서 A에게 돌려주고 더이상 통신할 수 없도록 선을 끊는다.  

연결이 끊기기 때문에 부하가 적지만, 다시 연결될 땐 항상 새로운 대상으로 인식한다. (구분하지 못한다.)  


# 9️⃣ 톰켓이란 무엇인가요?
HTTP는 운영체제가 가지고 있는 소켓을 이용해서 
프로그램이 운영체제가 들고있는 어떤 기능을 통해서 프로그램을 만들 때 이를 불러서 사용하는 것을 `시스템 콜`이라고 한다.

### 톰켓 vs 웹서버
`웹서버`: 컴퓨터를 하나 샀는데 재밌는 동영상 3개를 가지고 있다.  
친구들(을) 집에도 컴퓨터 있는데 내(갑) 동영상을 보고 싶다. 친구들이 내 데이터가 필요한 상황   

을이 필요한 데이터를 갑이 가지고 있다.  
을 -> request -> 갑
- 갑의 컴퓨터가 어디에 있는지 알아야해서 IP 주소를 알아야 한다.  
- 어떤 동영상을 요구하는지 정확하게 알아야 하기 때문에 URL(자원을 요청: 주소)

갑 -> respone -> 을
- request 할 때 을이 밝힌 IP 주소를 토대로 정보를 response해주면 된다.
- 갑은 웹서버가 된다.
- **갑은 을의 IP 주소를 모른다.** 알 필요가 없다. 을이 요청할 때만 응답해주면 되기 때문에
- 요청하지 않았을 때 응답 x -> 을의 주소를 몰라서!! => (연결이 지속된) 소켓을 써야함

<img width="740" alt="톰캣" src="https://github.com/fbgjung/backend-springboot-study/assets/104186871/2c7b6d9a-07e6-407a-9f5d-35f1a58c7ea1">

### `아파치` (웹서버)
아파치서버란 클라이언트에서 요청하는 HTTP 요청을 처리하는 웹서버를 의미한다.  
정적 타입(HTML, CSS, 이미지 등)의 데이터만을 처리한다. -> 톰캣이 등장한 이유  

웹서버는 흔히 아파치를 사용한다.  
컴퓨터에 폴더 하나를 지정하고 사람들한테 공유한다고 해보자  

request를 웹서버에 보내면 아파치는 response를 해주고 끝난다.  
만약 `.JSP(자바 코드)` 파일을 요청하면 아파치는 자바코드를 이해하지 못하고 응답할 수 없다.


### `톰켓`
DB 처리와 같은 동적인 기능들을 가공하여 `HTML` 파일로 만들어 클라이언트에게 제공한다.  
- 자바 서블릿을 실행하고
- JSP 코드가 포함되어 있는 웹 페이지를 만들어준다.  
- 웹서버에서 넘어온 동적 페이지를 읽어들여 프로그램을 실행하고 그 결과를 다시 HTML로 재구성하여 아파치에게 되돌려 준다.

그렇기 때문에  
아파치에 톰켓을 단다.  
아파치가 이해하지 못하는 요청이 오면, 제어권을 톰캣에 넘겨버린다.  

### 왜 아파치와 톰캣을 연동해서 사용하는 걸까?
웹페이지는 정적 데이터뿐만 아니라 동적 데이터도 함께 존재한다. 톰캣은 was서버이지만 web서버의 기능도 갖추고 있다. 하지만 아파치 웹서버보다 느린 처리속도를 제공하기 때문에 모든 데이터를 톰캣으로만 처리한다면 응답이 엄청 느려지게 될 것이다. 그래서 정적 데이터는 아파치가 동적 데이터는 톰캣이 분산 처리한다.


### `+서블릿`
클라이언트의 요청을 받고 요청을 처리하여 결과를 클라이언트에게 제공하는 자바 인터페이스


## 참고
[[아파치, 톰캣] Apache? Tomcat?? 둘이 무슨 차이지?](https://velog.io/@kdhyo/Apache-Tomcat-%EB%91%98%EC%9D%B4-%EB%AC%B4%EC%8A%A8-%EC%B0%A8%EC%9D%B4%EC%A7%80)